

```{r}
library(tidyverse)
library(dplyr)

install.packages('gclus')
install.packages('usmap')

library(gclus)

library(broom)

library(patchwork)

library(sandwich)
library(lmtest)

```

```{r}
setwd(".")
data <- read.csv("Selected_Data_V1.csv", strip.white=TRUE)
data_fips <- read.csv("vaccines.csv", strip.white=TRUE)
```

```{r}
head(data)
head(data_fips)
# state_check = select(data, "County", "TotPop", "State", "Dose1Pct")
# data_frame(state_check)
# new_df = select(state_check, state_check$State == "AL")
# new_df

# no_vaccine_check = select(data, "County", "TotPop", "State", "Dose1Pct")
# no_vaccine_check = subset(no_vaccine_check, Dose1Pct == 0)
```

The data that we are trying to operationalize is:
- vaccination rate: `Administered_Dose1_Pop_Pct`
- car access: (`Total.Households`-`No.vehicle.available`)/`Total.Households // Fraction of households with at least 1 car


```{r}

hist(data$CarPct, xlim=c(80,100), breaks=60)
hist(data$Dose1Pct)

summary_cars = summary(data$CarPct)
summary_vaccine = summary(data$Dose1Pct)



```

```{r}
summary_cars
summary_vaccine
nrow(data)
sum(data$Dose1Pct == 0)
sum(data$TripsOver100PerCap > 0, na.rm = TRUE)
```

```{r}
no_vaccine_check = select(data, "County", "TotPop", "State", "Dose1Pct")
no_vaccine_check = subset(no_vaccine_check, Dose1Pct == 0)

no_vaccine_check
# view(no_vaccine_check)


```


```{r}
plot(data$TripsOver250PerCap,data$Dose1Pct)


```



```{r}
install.packages("corrplot")



pairs(~TripsOver250PerCap + CarPct + IncomePerCap + Dose1Pct, data=data)


```

```{r}

# library(gclus)
# 
# numeric_data = dplyr::select_if(data, is.numeric)
# 
# dta.r <- abs(cor(numeric_data)) # get correlations
# dta.r <- complete.cases(data)
# dta.col <- dmat.color(dta.r) # get colors
# # reorder variables so those with highest correlation
# # are closest to the diagonal
# dta.o <- order.single(dta.r)
# cpairs(numeric_data, dta.o, panel.colors=dta.col, gap=.5,
# main="Variables Ordered and Colored by Correlation" )

names(data_fips)[names(data_fips) == 'Recip_County'] <- 'County'

data2 <- merge(data,data_fips,by = "County")
names(data2)[names(data2) == 'FIPS'] <- 'fips'
data_fips
data
data2
library(usmap)
library(ggplot2)

plot_usmap("counties", data = data2, values = "Dose1Pct", exclude = c("TX", "AK", "HI")) +
   labs(title = "Vaccination Rate by County (Excluding non-reporting counties)", subtitle = "Do counties with a higher vaccination rate have more travel?") +  ggplot2::scale_fill_continuous(low = "gray", high = "Blue", name = "Vaccination rate") +
  theme(legend.position = "right")
  
```
```{r}

model  = lm(TripsOver250PerCap ~ Dose1Pct + AirportEnplanements, data=data)
model

model2 = lm(TripsOver250PerCap ~ Dose1Pct + CarPct + IncomePerCap + AirportEnplanements + BachelorsPct + WhitePct + BlackPct + IndigenousPct + HispanicPct + AsianPct, data=data)
model2

model3 = lm(TripsOver250PerCap ~ Dose1Pct + CarPct + IncomePerCap + AirportEnplanements + BachelorsPct + WhitePct + BlackPct + IndigenousPct + HispanicPct + AsianPct, data=data)
model3

model4 = lm(TripsOver250PerCap ~ CarPct + AirportEnplanements, data=data)
model4


coeftest(model2, vcov=vcovHC(model2))
coeftest(model, vcov=vcovHC(model))
coeftest(model4, vcov=vcovHC(model4))

anova(model3, model4, test = "F")
anova(model, model2, test = "F")

# 
# install.packages("Hmisc")
# library("Hmisc")
# data = drop_na(data)
# res2 <- rcorr(as.matrix(data))
# res2



```